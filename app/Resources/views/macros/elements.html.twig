{% macro folder(folder) %}
    {% set created = folder.createdAt | time_diff %}
    {% set deleted = folder.createdAt | date_modify( days_before_clean ~ " days" ) | time_diff %}
    {% set organization = folder.owner is empty ? _('label.anon_user') : folder.owner.organization.code %}

    <li>
        <div class="square">
            <span class="icon"><i class="fa fa-folder-o"></i></span>
        </div>
        <div class="info">
            <h2 class="title"><a href="{{ path('folder_show', {'slug': folder.slug}) }}">{{ folder.name }}</a></h2>
            <p class="desc">
                <small>
                    {{ _('file.upload_from', {'%organization%': organization, '%created%': created }) | raw }}
                    {%- if not folder.isPermanent %}
                        {{ _('file.available_until', {'%deleted%': deleted}) | raw }}
                    {% endif -%}
                </small>
            </p>
            <ul>
                {% for tag in folder.tags %}
                    <li><span class="label label-default"><i class="fa fa-tag"></i> {{ tag }}</span></li>
                {% endfor %}
            </ul>
        </div>
        <div class="actions">
            <ul>
                <li class="action" style="width:33%;"><a href="{{ path('folder_show', {'slug': folder.slug}) }}"><span class="fa fa-folder-open-o"></span></a></li>
                {% if is_granted('SHARE', folder) %}
                    <li class="action share" style="width:34%;" data-toggle="modal" data-target="#ShareModal" data-url="{{ url("folder_share",{'slug':folder.slug,'shareCode': folder.shareCode }) }}"><a href="#" title="Share {{ folder.name }}"><span class="fa fa-share-alt"></span></a></li>
                {% endif %}
                {% if is_granted('DELETE', folder) %}
                    <li class="action trash" style="width:33%;" data-toggle="modal" data-target="#DeleteModal" data-url="{{ path('folder_delete',{'slug':folder.slug}) }}"><a href="#" title="Delete {{ folder.name }}"><span class="fa fa-trash"></span></a></li>
                {% endif %}
            </ul>
        </div>
    </li>
{% endmacro %}


{% macro file(file) %}
    {% set created = file.createdAt | time_diff %}
    {% set deleted = file.createdAt | date_modify( days_before_clean ~ " days" ) | time_diff %}
    {% set organization = file.owner is empty ? _('label.anon_user') : file.owner.organization.code %}

    <li>
        <div class="square">
            <span class="icon"><i class="fa fa-file-o"></i></span>
        </div>
        <div class="info">
            <h2 class="title"><a href="{{ path("file_show", {'slug': file.slug}) }}">{{ file.name }}</a></h2>
            <p class="desc">
                <small>
                    {{ _('file.upload_from', {'%organization%': organization, '%created%': created }) | raw }}
                    {{ _('file.available_until', {'%deleted%': deleted}) | raw }}
                </small>
            </p>
            <ul>
                {% for tag in file.tags %}
                    <li><span class="label label-default"><i class="fa fa-tag"></i> {{ tag }}</span></li>
                {% endfor %}
            </ul>
        </div>
        <div class="actions">
            <ul>
                <li class="action" style="width:33%;"><a href="{{ path('file_show', {'slug': file.slug}) }}" title="Download {{ file.name }}"><span class="fa fa-download"></span></a></li>
                {% if is_granted('SHARE', file) %}
                    <li class="action share" style="width:34%;" data-toggle="modal" data-target="#ShareModal" data-url="{{ url('file_share',{'slug':file.slug, 'shareCode': file.shareCode}) }}" ><a href="#" title="Share {{ file.name }}"><span class="fa fa-share-alt"></span></a></li>
                {% endif %}
                {% if is_granted('DELETE', file) %}
                    <li class="action trash" style="width:33%;" data-toggle="modal" data-target="#DeleteModal" data-url="{{ path('file_delete',{'slug':file.slug}) }}"><a href="#" title="Delete {{ file.name }}"><span class="fa fa-trash"></span></a></li>
                {% endif %}
            </ul>
        </div>
    </li>
{% endmacro %}

{% macro folderfile(file) %}
    {% set created = file.createdAt | time_diff %}
    {% set organization = file.owner is empty ? _('label.anon_user') : file.owner.organization.code %}

    <li>
        <div class="square">
            {% if file.mimeType starts with 'audio/' %}
            <span class="icon"><i class="fa fa-file-sound-o"></i></span>
            {% else %}
            <span class="icon"><i class="fa fa-file-o"></i></span>
            {% endif %}

        </div>
        <div class="info">
            <h2 class="title"><a href="{{ path("folder_file_download", {'slug': file.slug}) }}">{{ file.name }}</a></h2>
            <p class="desc">
                <small>
                    {{ _('file.upload_from', {'%organization%': organization, '%created%': created }) | raw }}
                </small>
                {% if file.mimeType starts with 'audio/' %}
                <div class="player">
                    <audio controls preload="none">
                        <!-- Audio files -->
                        <source src="{{ path('folder_file_download', {'slug': file.slug}) }}" type="{{ file.mimeType }}">
                    </audio>
                </div>
                {% endif %}
            </p>
            <ul>
                {% for tag in file.tags %}
                    <li><span class="label label-default"><i class="fa fa-tag"></i> {{ tag }}</span></li>
                {% endfor %}
            </ul>
        </div>
        <div class="actions">
            <ul>
                <li class="action" style="width:33%;"><a href="{{ path("folder_file_download", {'slug': file.slug}) }}" title="Download {{ file.name }}"><span class="fa fa-download"></span></a></li>
                {% if is_granted('SHARE', file) %}
                    <li class="action share" style="width:34%;" data-toggle="modal" data-target="#ShareModal" data-url="{{ url('file_share',{'slug':file.slug, 'shareCode': file.shareCode}) }}" ><a href="#" title="Share {{ file.name }}"><span class="fa fa-share-alt"></span></a></li>

                {% endif %}
                {% if is_granted('DELETE', file.folder) %}
                    <li class="action trash" style="width:33%;" data-toggle="modal" data-target="#DeleteModal" data-url="{{ path("folder_file_delete", {'slug': file.slug}) }}"><a href="#" title="Delete {{ file.name }}"><span class="fa fa-trash"></span></a></li>
                {% endif %}
            </ul>
        </div>
    </li>
{% endmacro %}

{% macro bytesToSize(bytes) %}
    {% spaceless %}
        {% set kilobyte = 1024 %}
        {% set megabyte = kilobyte * 1024 %}
        {% set gigabyte = megabyte * 1024 %}
        {% set terabyte = gigabyte * 1024 %}

        {% if bytes < kilobyte %}
            {{ bytes ~ ' bytes' }}
        {% elseif bytes < megabyte %}
            {{ (bytes / kilobyte)|number_format(2, '.') ~ ' KB' }}
        {% elseif bytes < gigabyte %}
            {{ (bytes / megabyte)|number_format(2, '.') ~ ' MB' }}
        {% elseif bytes < terabyte %}
            {{ (bytes / gigabyte)|number_format(2, '.') ~ ' GB' }}
        {% else %}
            {{ (bytes / terabyte)|number_format(2, '.') ~ ' TB' }}
        {% endif %}
    {% endspaceless %}
{% endmacro %}

